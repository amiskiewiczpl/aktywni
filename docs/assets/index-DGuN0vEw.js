(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const I={"/":()=>d("home-tpl"),"/wydarzenia":z,"/nowe":()=>j(()=>d("create-tpl",J)),"/login":U,"/profil":W};function d(e,t){const n=document.getElementById(e);document.getElementById("app").innerHTML=n.innerHTML,t&&t()}function S(){const e=location.hash.replace("#","");document.querySelectorAll("header .btn").forEach(t=>t.classList.remove("active")),e.startsWith("/wydarzenia")&&document.getElementById("nav-events").classList.add("active"),e.startsWith("/nowe")&&document.getElementById("nav-create").classList.add("active"),e.startsWith("/login")&&document.getElementById("nav-login").classList.add("active"),e.startsWith("/profil")&&document.getElementById("nav-profile").classList.add("active")}window.addEventListener("hashchange",()=>{S(),B()});function B(){const e=location.hash.replace("#","")||"/";(I[e]||I["/"])(),w()}const h="aktywni:auth:user";function v(){try{return JSON.parse(localStorage.getItem(h))}catch{return null}}function N(e){localStorage.setItem(h,JSON.stringify(e)),w()}function P(){localStorage.removeItem(h),w()}function w(){const e=v(),t=document.getElementById("nav-login"),n=document.getElementById("nav-profile"),a=document.getElementById("nav-create");!t||!n||(e?(t.style.display="none",n.style.display="",n.textContent=e.name?`Profil (${e.name})`:"Profil",a.classList.remove("link")):(t.style.display="",n.style.display="none",n.textContent="Profil",a.classList.add("link")))}function j(e){if(!v()){location.hash="#/login";return}e()}const y="aktywni:events:v1",k="aktywni:signups:v1";function l(){try{if(window.crypto&&window.crypto.randomUUID)return window.crypto.randomUUID()}catch{}return"id-"+Math.random().toString(36).slice(2)+Date.now()}const b=[{id:l(),title:"Bieg nad Wisłą",datetime:g(3,"18:00"),place:"Bulwary Wiślane, Warszawa",lat:52.237,lng:21.022,capacity:20,taken:5,banner:"https://images.unsplash.com/photo-1546483875-ad9014c88eba?q=80&w=1200&auto=format&fit=crop",desc:"Lekki bieg ~6km, tempo konwersacyjne. Każdy mile widziany."},{id:l(),title:"Siatkówka plażowa",datetime:g(5,"17:30"),place:"Plaża Poniatówka",lat:52.234,lng:21.04,capacity:12,taken:9,banner:"https://images.unsplash.com/photo-1517649763962-0c623066013b?q=80&w=1200&auto=format&fit=crop",desc:"Gramy 3×3, poziom rekreacyjny. Zabierz wodę i uśmiech :)"},{id:l(),title:"Joga w parku",datetime:g(2,"08:30"),place:"Park Skaryszewski",lat:52.244,lng:21.056,capacity:25,taken:12,banner:"https://images.unsplash.com/photo-1552196563-55cd4e45efb3?q=80&w=1200&auto=format&fit=crop",desc:"Poranna sesja vinyasa, mata mile widziana."}];function g(e,t="10:00"){const n=new Date(Date.now()+e*24*3600*1e3),a=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0");return`${a}-${o}-${i}T${t}`}function u(){const e=localStorage.getItem(y);if(e)try{return JSON.parse(e)}catch(t){console.warn(t)}return localStorage.setItem(y,JSON.stringify(b)),b}function O(e){localStorage.setItem(y,JSON.stringify(e))}function C(){return JSON.parse(localStorage.getItem(k)||"{}")}function H(e){localStorage.setItem(k,JSON.stringify(e))}function z(){d("events-tpl");const e=document.getElementById("events-list"),t=u().sort((n,a)=>new Date(n.datetime)-new Date(a.datetime));e.innerHTML="",t.forEach(n=>e.appendChild(F(n)))}function F(e){const t=document.createElement("div");return t.className="event",t.innerHTML=`
    <div class="banner">${e.banner?`<img src="${e.banner}" alt="${e.title}">`:""}</div>
    <div>
      <div class="title">${e.title}</div>
      <div class="meta">${$(e.datetime)} · ${e.place}</div>
    </div>
    <div style="display:flex; gap:8px; align-items:center">
      ${D(e)}
      <button class="btn" aria-label="Otwórz szczegóły">Szczegóły</button>
    </div>`,t.querySelector("button").addEventListener("click",()=>q(e.id)),t}function D(e){const t=Math.max(0,e.capacity-(e.taken||0));return`<span class="pill ${t===0?"none":t<5?"low":"ok"}">${t} wolnych</span>`}function J(){const e=document.getElementById("create-form");e.addEventListener("submit",t=>{t.preventDefault();const n=new FormData(e),a=Object.fromEntries(n.entries());a.id=l(),a.capacity=Number(a.capacity)||1,a.taken=0,a.lat=parseFloat(a.lat),a.lng=parseFloat(a.lng),O([...u(),a]),location.hash="#/wydarzenia"})}function U(){d("login-tpl",()=>{const e=document.getElementById("login-form");e.addEventListener("submit",t=>{t.preventDefault();const{email:n,name:a}=Object.fromEntries(new FormData(e).entries());N({uid:l(),email:n,name:a}),location.hash="#/profil"})})}function W(){const e=v();if(!e){location.hash="#/login";return}d("profile-tpl",()=>{const t=document.getElementById("profile-box");t.innerHTML=`
      <div class="meta">Zalogowano jako:</div>
      <div style="font-weight:700">${e.name||"(bez imienia)"}</div>
      <div class="meta">${e.email}</div>
    `,document.getElementById("btn-logout").addEventListener("click",()=>{P(),location.hash="#/login"})})}let c,f;function q(e){const t=u().find(i=>i.id===e);if(!t)return;document.getElementById("m-title").textContent=t.title,document.getElementById("m-title-sm").textContent=t.title,document.getElementById("m-when").textContent=$(t.datetime),document.getElementById("m-place").textContent=t.place,document.getElementById("m-desc").textContent=t.desc||"",document.getElementById("m-cap-pill").outerHTML=D(t);const n=document.getElementById("m-banner");n.innerHTML=t.banner?`<img src="${t.banner}" alt="${t.title}" style="width:100%; height:100%; object-fit:cover">`:"",document.getElementById("event-modal").classList.add("open"),c||(c=L.map("map"),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap"}).addTo(c)),c.setView([t.lat,t.lng],14),f&&f.remove(),f=L.marker([t.lat,t.lng]).addTo(c).bindPopup(t.title);const o=document.getElementById("join-form");o.onsubmit=i=>{i.preventDefault();const{name:s,email:x}=Object.fromEntries(new FormData(o).entries()),r=u(),m=r.findIndex(M=>M.id===e),T=r[m].capacity-(r[m].taken||0),E=document.getElementById("join-msg");if(T<=0){E.innerHTML='<span class="danger">Brak miejsc</span>';return}r[m].taken=(r[m].taken||0)+1,O(r);const p=C();(p[e]=p[e]||[]).push({name:s,email:x,at:new Date().toISOString()}),H(p),E.innerHTML='<span class="success">Jesteś zapisany/a! Do zobaczenia 🔥</span>',z()}}document.getElementById("m-close").addEventListener("click",()=>document.getElementById("event-modal").classList.remove("open"));document.getElementById("event-modal").addEventListener("click",e=>{e.target.id==="event-modal"&&e.currentTarget.classList.remove("open")});function $(e){try{return new Date(e).toLocaleString("pl-PL",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}}document.getElementById("year").textContent=new Date().getFullYear();location.hash||(location.hash="#/");S();B();
