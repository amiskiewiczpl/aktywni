(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const w={"/":()=>g("home-tpl"),"/wydarzenia":k,"/nowe":()=>g("create-tpl",N)};function g(e,t){const i=document.getElementById(e);document.getElementById("app").innerHTML=i.innerHTML,t&&t()}function E(){const e=location.hash.replace("#","");document.querySelectorAll("header .btn").forEach(t=>t.classList.remove("active")),e.startsWith("/wydarzenia")&&document.getElementById("nav-events").classList.add("active"),e.startsWith("/nowe")&&document.getElementById("nav-create").classList.add("active")}window.addEventListener("hashchange",()=>{E(),b()});function b(){const e=location.hash.replace("#","")||"/";(w[e]||w["/"])()}const f="aktywni:events:v1",I="aktywni:signups:v1";function m(){try{if(window.crypto&&window.crypto.randomUUID)return window.crypto.randomUUID()}catch{}return"id-"+Math.random().toString(36).slice(2)+Date.now()}const v=[{id:m(),title:"Bieg nad Wis",datetime:p(3,"18:00"),place:"Bulwary Wilane, Warszawa",lat:52.237,lng:21.022,capacity:20,taken:5,banner:"https://images.unsplash.com/photo-1546483875-ad9014c88eba?q=80&w=1200&auto=format&fit=crop",desc:"Lekki bieg ~6km, tempo konwersacyjne. Ka偶dy mile widziany."},{id:m(),title:"Siatk贸wka pla偶owa",datetime:p(5,"17:30"),place:"Pla偶a Poniat贸wka",lat:52.234,lng:21.04,capacity:12,taken:9,banner:"https://images.unsplash.com/photo-1517649763962-0c623066013b?q=80&w=1200&auto=format&fit=crop",desc:"Gramy 33, poziom rekreacyjny. Zabierz wod i umiech :)"},{id:m(),title:"Joga w parku",datetime:p(2,"08:30"),place:"Park Skaryszewski",lat:52.244,lng:21.056,capacity:25,taken:12,banner:"https://images.unsplash.com/photo-1552196563-55cd4e45efb3?q=80&w=1200&auto=format&fit=crop",desc:"Poranna sesja vinyasa, mata mile widziana."}];function p(e,t="10:00"){const i=new Date(Date.now()+e*24*3600*1e3),a=i.getFullYear(),n=String(i.getMonth()+1).padStart(2,"0"),o=String(i.getDate()).padStart(2,"0");return`${a}-${n}-${o}T${t}`}function u(){const e=localStorage.getItem(f);if(e)try{return JSON.parse(e)}catch(t){console.warn(t)}return localStorage.setItem(f,JSON.stringify(v)),v}function S(e){localStorage.setItem(f,JSON.stringify(e))}function T(){return JSON.parse(localStorage.getItem(I)||"{}")}function $(e){localStorage.setItem(I,JSON.stringify(e))}function k(){g("events-tpl");const e=document.getElementById("events-list"),t=u().sort((i,a)=>new Date(i.datetime)-new Date(a.datetime));e.innerHTML="",t.forEach(i=>e.appendChild(x(i)))}function x(e){const t=document.createElement("div");return t.className="event",t.innerHTML=`
    <div class="banner">${e.banner?`<img src="${e.banner}" alt="${e.title}">`:""}</div>
    <div>
      <div class="title">${e.title}</div>
      <div class="meta">${z(e.datetime)} 路 ${e.place}</div>
    </div>
    <div style="display:flex; gap:8px; align-items:center">
      ${B(e)}
      <button class="btn" aria-label="Otw贸rz szczeg贸y">Szczeg贸y</button>
    </div>`,t.querySelector("button").addEventListener("click",()=>P(e.id)),t}function B(e){const t=Math.max(0,e.capacity-(e.taken||0));return`<span class="pill ${t===0?"none":t<5?"low":"ok"}">${t} wolnych</span>`}function N(){const e=document.getElementById("create-form");e.addEventListener("submit",t=>{t.preventDefault();const i=new FormData(e),a=Object.fromEntries(i.entries());a.id=m(),a.capacity=Number(a.capacity)||1,a.taken=0,a.lat=parseFloat(a.lat),a.lng=parseFloat(a.lng),S([...u(),a]),location.hash="#/wydarzenia"})}let s,y;function P(e){const t=u().find(o=>o.id===e);if(!t)return;document.getElementById("m-title").textContent=t.title,document.getElementById("m-title-sm").textContent=t.title,document.getElementById("m-when").textContent=z(t.datetime),document.getElementById("m-place").textContent=t.place,document.getElementById("m-desc").textContent=t.desc||"",document.getElementById("m-cap-pill").outerHTML=B(t);const i=document.getElementById("m-banner");i.innerHTML=t.banner?`<img src="${t.banner}" alt="${t.title}" style="width:100%; height:100%; object-fit:cover">`:"",document.getElementById("event-modal").classList.add("open"),s||(s=L.map("map"),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap"}).addTo(s)),s.setView([t.lat,t.lng],14),y&&y.remove(),y=L.marker([t.lat,t.lng]).addTo(s).bindPopup(t.title);const n=document.getElementById("join-form");n.onsubmit=o=>{o.preventDefault();const{name:c,email:D}=Object.fromEntries(new FormData(n).entries()),r=u(),l=r.findIndex(M=>M.id===e),O=r[l].capacity-(r[l].taken||0),h=document.getElementById("join-msg");if(O<=0){h.innerHTML='<span class="danger">Brak miejsc</span>';return}r[l].taken=(r[l].taken||0)+1,S(r);const d=T();d[e]=d[e]||[],d[e].push({name:c,email:D,at:new Date().toISOString()}),$(d),h.innerHTML='<span class="success">Jeste zapisany/a! Do zobaczenia </span>',k()}}document.getElementById("m-close").addEventListener("click",()=>document.getElementById("event-modal").classList.remove("open"));document.getElementById("event-modal").addEventListener("click",e=>{e.target.id==="event-modal"&&e.currentTarget.classList.remove("open")});function z(e){try{return new Date(e).toLocaleString("pl-PL",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}}document.getElementById("year").textContent=new Date().getFullYear();location.hash||(location.hash="#/");E();b();
